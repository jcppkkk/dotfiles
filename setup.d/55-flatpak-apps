#!/bin/bash
# vim: set et fenc=utf-8 ff=unix sts=4 sw=4 ts=8 :
common_lib="$(dirname "$(readlink -f "$0")")/common-lib"
if [[ -f "$common_lib" ]]; then
    # shellcheck source=common-lib
    . "$common_lib"
else
    echo "Cannot find common-lib."
    exit 1
fi

[[ "$DISTRIB_ID" != Ubuntu ]] && exit
if ! command -v flatpak &>/dev/null; then
    update_pkg_list
    sudo apt-get install -y flatpak
fi

# Ensure flathub remote is added (both system and user level)
if ! flatpak remote-list | grep -q flathub; then
    sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
fi
# Add user-level remote if using --user install
if ! flatpak remote-list --user | grep -q flathub; then
    flatpak remote-add --user --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
fi

flatpak install --user -y flathub org.telegram.desktop
flatpak install --user -y flathub com.ticktick.TickTick
flatpak install --user -y flathub org.keepassxc.KeePassXC
flatpak --user override --filesystem=/usr/share/icons:ro
for path in ~/Documents/ ~/Downloads/ ~/Music/ ~/Pictures/ ~/Videos/; do
    flatpak --user override --filesystem="$path"
done
